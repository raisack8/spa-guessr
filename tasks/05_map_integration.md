# ğŸ—ºï¸ Mapboxåœ°å›³æ©Ÿèƒ½çµ±åˆ

## ğŸ“‹ ã‚¿ã‚¹ã‚¯ä¸€è¦§

### 1. MapboxåŸºç›¤ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- [ ] **1.1 Mapboxè¨­å®šãƒ»åˆæœŸåŒ–**
  - [ ] 1.1.1 ç’°å¢ƒå¤‰æ•°è¨­å®šç¢ºèª (`NEXT_PUBLIC_MAPBOX_ACCESS_TOKEN`)
  - [ ] 1.1.2 `lib/mapbox/config.ts` è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
  - [ ] 1.1.3 æ—¥æœ¬åœ°å›³ã®å¢ƒç•Œè¨­å®šï¼ˆmaxBoundsï¼‰
  - [ ] 1.1.4 åˆæœŸè¡¨ç¤ºè¨­å®šï¼ˆcenter, zoom, styleï¼‰

- [ ] **1.2 Mapboxå‹å®šç¾©ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£**
  - [ ] 1.2.1 `lib/mapbox/types.ts` å‹å®šç¾©ä½œæˆ
  - [ ] 1.2.2 åœ°å›³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å‹å®šç¾©
  - [ ] 1.2.3 ãƒãƒ¼ã‚«ãƒ¼ãƒ»ãƒ”ãƒ³å‹å®šç¾©
  - [ ] 1.2.4 åº§æ¨™ãƒ»å¢ƒç•Œå‹å®šç¾©

### 2. åŸºæœ¬åœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- [ ] **2.1 ãƒ¡ã‚¤ãƒ³åœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
  - [ ] 2.1.1 `components/map/MapboxMap.tsx` åŸºæœ¬åœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
    - [ ] 2.1.1.1 åœ°å›³ã‚³ãƒ³ãƒ†ãƒŠRefè¨­å®š
    - [ ] 2.1.1.2 Mapbox GL JSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åˆæœŸåŒ–
    - [ ] 2.1.1.3 æ—¥æœ¬å¢ƒç•Œå†…åˆ¶é™è¨­å®š
    - [ ] 2.1.1.4 åˆæœŸã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šï¼ˆsatellite-v9ï¼‰
    - [ ] 2.1.1.5 useEffect ã§ã®ãƒã‚¦ãƒ³ãƒˆãƒ»ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆ

- [ ] **2.2 åœ°å›³æ“ä½œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«**
  - [ ] 2.2.1 `components/map/MapControls.tsx` æ“ä½œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ä½œæˆ
    - [ ] 2.2.1.1 ã‚ºãƒ¼ãƒ ã‚¤ãƒ³ãƒ»ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³
    - [ ] 2.2.1.2 åœ°å›³ãƒªã‚»ãƒƒãƒˆï¼ˆå…¨ä½“è¡¨ç¤ºï¼‰ãƒœã‚¿ãƒ³
    - [ ] 2.2.1.3 è¡›æ˜Ÿãƒ»åœ°å›³è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³
    - [ ] 2.2.1.4 ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«UI

- [ ] **2.3 ã‚³ãƒ³ãƒ‘ã‚¹ãƒ»æ–¹å‘è¡¨ç¤º**
  - [ ] 2.3.1 `components/map/CompassOverlay.tsx` ã‚³ãƒ³ãƒ‘ã‚¹ä½œæˆ
    - [ ] 2.3.1.1 åŒ—æ–¹å‘ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
    - [ ] 2.3.1.2 ã‚¯ãƒªãƒƒã‚¯ã§ã®åŒ—å‘ããƒªã‚»ãƒƒãƒˆ
    - [ ] 2.3.1.3 å›è»¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ
    - [ ] 2.3.1.4 GeoGuessré¢¨ãƒ‡ã‚¶ã‚¤ãƒ³

### 3. ãƒ”ãƒ³ãƒ»ãƒãƒ¼ã‚«ãƒ¼æ©Ÿèƒ½
- [ ] **3.1 æ¨æ¸¬ãƒ”ãƒ³æ©Ÿèƒ½**
  - [ ] 3.1.1 `components/map/GuessPin.tsx` æ¨æ¸¬ãƒ”ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    - [ ] 3.1.1.1 é’è‰²ãƒ”ãƒ³è¡¨ç¤ºï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨æ¸¬ï¼‰
    - [ ] 3.1.1.2 åœ°å›³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ”ãƒ³é…ç½®
    - [ ] 3.1.1.3 ãƒ‰ãƒ©ãƒƒã‚°ã§ãƒ”ãƒ³ç§»å‹•æ©Ÿèƒ½
    - [ ] 3.1.1.4 ãƒ”ãƒ³é…ç½®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

- [ ] **3.2 æ­£è§£ãƒ”ãƒ³è¡¨ç¤º**
  - [ ] 3.2.1 `components/map/AnswerPin.tsx` æ­£è§£ãƒ”ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    - [ ] 3.2.1.1 èµ¤è‰²ãƒ”ãƒ³è¡¨ç¤ºï¼ˆæ­£è§£ä½ç½®ï¼‰
    - [ ] 3.2.1.2 å›ºå®šä½ç½®è¡¨ç¤ºï¼ˆç§»å‹•ä¸å¯ï¼‰
    - [ ] 3.2.1.3 çµæœç™ºè¡¨æ™‚ã®ã¿è¡¨ç¤º
    - [ ] 3.2.1.4 ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ

- [ ] **3.3 è·é›¢ç·šè¡¨ç¤º**
  - [ ] 3.3.1 `components/map/DistanceLine.tsx` è·é›¢ç·šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
    - [ ] 3.3.1.1 æ¨æ¸¬ä½ç½®ã¨æ­£è§£ä½ç½®ã‚’çµã¶ç·š
    - [ ] 3.3.1.2 GeoJSON LineStringä½¿ç”¨
    - [ ] 3.3.1.3 ç·šã®è‰²ãƒ»å¤ªã•è¨­å®š
    - [ ] 3.3.1.4 ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æç”»

### 4. åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«ãƒ»è¡¨ç¤ºè¨­å®š
- [ ] **4.1 åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆ**
  - [ ] 4.1.1 `lib/mapbox/styles.ts` ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
    - [ ] 4.1.1.1 è¡›æ˜Ÿç”»åƒã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š
    - [ ] 4.1.1.2 æ¨™æº–åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š
    - [ ] 4.1.1.3 åœ°åè¡¨ç¤ºãƒ»éè¡¨ç¤ºè¨­å®š
    - [ ] 4.1.1.4 ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆé–¢æ•°

- [ ] **4.2 åœ°å›³è¡¨ç¤ºæœ€é©åŒ–**
  - [ ] 4.2.1 æ—¥æœ¬åœ°åŸŸç‰¹åŒ–è¨­å®š
    - [ ] 4.2.1.1 æ—¥æœ¬ã®åœ°ç†çš„å¢ƒç•Œè¨­å®š (maxBounds)
    - [ ] 4.2.1.2 æœ€å°ãƒ»æœ€å¤§ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«è¨­å®š
    - [ ] 4.2.1.3 åˆæœŸè¡¨ç¤ºä¸­å¿ƒç‚¹è¨­å®šï¼ˆæ—¥æœ¬ä¸­å¤®ï¼‰
    - [ ] 4.2.1.4 ç¯„å›²å¤–ãƒ‘ãƒ³é˜²æ­¢è¨­å®š

### 5. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
- [ ] **5.1 åœ°å›³ã‚¯ãƒªãƒƒã‚¯ãƒ»æ“ä½œ**
  - [ ] 5.1.1 `lib/mapbox/interactions.ts` æ“ä½œé–¢æ•°é›†
    - [ ] 5.1.1.1 åœ°å›³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
    - [ ] 5.1.1.2 åº§æ¨™å–å¾—ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    - [ ] 5.1.1.3 ãƒ”ãƒ³é…ç½®å¯èƒ½ã‚¨ãƒªã‚¢åˆ¤å®š
    - [ ] 5.1.1.4 ç„¡åŠ¹ã‚¨ãƒªã‚¢ã‚¯ãƒªãƒƒã‚¯è­¦å‘Š

- [ ] **5.2 ãƒ”ãƒ³ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½**
  - [ ] 5.2.1 ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãƒ”ãƒ³å®Ÿè£…
    - [ ] 5.2.1.1 mousedown/touchstart ã‚¤ãƒ™ãƒ³ãƒˆ
    - [ ] 5.2.1.2 mousemove/touchmove ã§ã®ç§»å‹•
    - [ ] 5.2.1.3 mouseup/touchend ã§ã®ç¢ºå®š
    - [ ] 5.2.1.4 ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

### 6. åœ°å›³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
- [ ] **6.1 ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**
  - [ ] 6.1.1 `lib/mapbox/animations.ts` ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°
    - [ ] 6.1.1.1 2ç‚¹ã‚’å«ã‚€ã‚ºãƒ¼ãƒ ï¼ˆfitBoundsï¼‰
    - [ ] 6.1.1.2 ã‚¹ãƒ ãƒ¼ã‚ºãƒ‘ãƒ³ãƒ»ã‚ºãƒ¼ãƒ è¨­å®š
    - [ ] 6.1.1.3 çµæœè¡¨ç¤ºæ™‚ã®è‡ªå‹•ãƒ•ã‚£ãƒƒãƒˆ
    - [ ] 6.1.1.4 ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦ãƒ»ã‚¤ãƒ¼ã‚¸ãƒ³ã‚°

- [ ] **6.2 ãƒãƒ¼ã‚«ãƒ¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**
  - [ ] 6.2.1 ãƒ”ãƒ³è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    - [ ] 6.2.1.1 ãƒ”ãƒ³å‡ºç¾æ™‚ã®ãƒã‚¦ãƒ³ã‚¹åŠ¹æœ
    - [ ] 6.2.1.2 ãƒ”ãƒ³æ¶ˆå»æ™‚ã®ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
    - [ ] 6.2.1.3 è·é›¢ç·šæç”»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    - [ ] 6.2.1.4 çµæœç™ºè¡¨æ¼”å‡º

### 7. ã‚²ãƒ¼ãƒ çµ±åˆæ©Ÿèƒ½
- [ ] **7.1 ã‚²ãƒ¼ãƒ çŠ¶æ…‹é€£å‹•**
  - [ ] 7.1.1 `hooks/useGameMap.ts` ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ä½œæˆ
    - [ ] 7.1.1.1 ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã¨ã®åŒæœŸ
    - [ ] 7.1.1.2 æ¨æ¸¬åº§æ¨™ã®ç®¡ç†
    - [ ] 7.1.1.3 åœ°å›³è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
    - [ ] 7.1.1.4 ãƒ©ã‚¦ãƒ³ãƒ‰é€²è¡Œã¨ã®é€£å‹•

- [ ] **7.2 çµæœè¡¨ç¤ºçµ±åˆ**
  - [ ] 7.2.1 çµæœç™ºè¡¨æ™‚ã®åœ°å›³è¡¨ç¤º
    - [ ] 7.2.1.1 æ¨æ¸¬ãƒ”ãƒ³ã¨æ­£è§£ãƒ”ãƒ³ã®åŒæ™‚è¡¨ç¤º
    - [ ] 7.2.1.2 è·é›¢ç·šã®è¡¨ç¤º
    - [ ] 7.2.1.3 ä¸¡ç‚¹ã‚’å«ã‚€æœ€é©ã‚ºãƒ¼ãƒ 
    - [ ] 7.2.1.4 çµæœæƒ…å ±ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º

### 8. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- [ ] **8.1 åœ°å›³ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–**
  - [ ] 8.1.1 `lib/mapbox/performance.ts` æœ€é©åŒ–è¨­å®š
    - [ ] 8.1.1.1 åœ°å›³ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿æœ€é©åŒ–
    - [ ] 8.1.1.2 ä¸è¦ãªãƒ¬ã‚¤ãƒ¤ãƒ¼éè¡¨ç¤º
    - [ ] 8.1.1.3 ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«åˆ¥è¡¨ç¤ºåˆ¶å¾¡
    - [ ] 8.1.1.4 ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æœ€é©åŒ–

- [ ] **8.2 ã‚¤ãƒ™ãƒ³ãƒˆæœ€é©åŒ–**
  - [ ] 8.2.1 ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç®¡ç†
    - [ ] 8.2.1.1 debounce/throttleé©ç”¨
    - [ ] 8.2.1.2 ä¸è¦ãªã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤
    - [ ] 8.2.1.3 ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢
    - [ ] 8.2.1.4 é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

### 9. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- [ ] **9.1 åœ°å›³èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼å¯¾å¿œ**
  - [ ] 9.1.1 `components/map/MapError.tsx` ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
    - [ ] 9.1.1.1 Mapboxã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ãƒ©ãƒ¼
    - [ ] 9.1.1.2 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼å¯¾å¿œ
    - [ ] 9.1.1.3 åœ°å›³èª­ã¿è¾¼ã¿å¤±æ•—æ™‚ã®è¡¨ç¤º
    - [ ] 9.1.1.4 å†è©¦è¡Œãƒœã‚¿ãƒ³æ©Ÿèƒ½

- [ ] **9.2 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½**
  - [ ] 9.2.1 åœ°å›³åˆ©ç”¨ä¸å¯æ™‚ã®ä»£æ›¿è¡¨ç¤º
    - [ ] 9.2.1.1 é™çš„åœ°å›³ç”»åƒè¡¨ç¤º
    - [ ] 9.2.1.2 åº§æ¨™å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ 
    - [ ] 9.2.1.3 éƒ½é“åºœçœŒé¸æŠUI
    - [ ] 9.2.1.4 ã‚¨ãƒ©ãƒ¼çŠ¶æ³ã®è¨˜éŒ²ãƒ»å ±å‘Š

## ğŸ”„ å®Ÿè£…é †åº

### Phase 1: åŸºç›¤æ§‹ç¯‰ (3æ™‚é–“)
1. MapboxåŸºç›¤ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ»è¨­å®š
2. åŸºæœ¬åœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆ
3. åœ°å›³æ“ä½œã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«å®Ÿè£…
4. ã‚³ãƒ³ãƒ‘ã‚¹ãƒ»æ–¹å‘è¡¨ç¤ºå®Ÿè£…

### Phase 2: ãƒ”ãƒ³ãƒ»ãƒãƒ¼ã‚«ãƒ¼æ©Ÿèƒ½ (4æ™‚é–“)
1. æ¨æ¸¬ãƒ”ãƒ³æ©Ÿèƒ½å®Ÿè£…
2. æ­£è§£ãƒ”ãƒ³è¡¨ç¤ºå®Ÿè£…
3. è·é›¢ç·šè¡¨ç¤ºå®Ÿè£…
4. ãƒ”ãƒ³ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½å®Ÿè£…

### Phase 3: é«˜åº¦ãªæ©Ÿèƒ½ (3æ™‚é–“)
1. åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆå®Ÿè£…
2. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¨ãƒ•ã‚§ã‚¯ãƒˆå®Ÿè£…
3. ã‚²ãƒ¼ãƒ çµ±åˆæ©Ÿèƒ½å®Ÿè£…

### Phase 4: æœ€é©åŒ–ãƒ»ä»•ä¸Šã’ (2æ™‚é–“)
1. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–å®Ÿè£…
2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…
3. ç·åˆãƒ†ã‚¹ãƒˆãƒ»èª¿æ•´

## ğŸ¯ å®Œäº†æ¡ä»¶

### åŸºæœ¬æ©Ÿèƒ½ç¢ºèªé …ç›®
- [ ] åœ°å›³ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆè¡›æ˜Ÿç”»åƒï¼‰
- [ ] æ—¥æœ¬å›½å†…ã®ã¿è¡¨ç¤ºåˆ¶é™ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] åœ°å›³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ”ãƒ³é…ç½®ãŒã§ãã‚‹
- [ ] ãƒ”ãƒ³ã®ãƒ‰ãƒ©ãƒƒã‚°ç§»å‹•ãŒã§ãã‚‹

### ã‚²ãƒ¼ãƒ çµ±åˆç¢ºèªé …ç›®
- [ ] æ¨æ¸¬ãƒ”ãƒ³ï¼ˆé’ï¼‰ã¨æ­£è§£ãƒ”ãƒ³ï¼ˆèµ¤ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] è·é›¢ç·šãŒæ­£ç¢ºã«æç”»ã•ã‚Œã‚‹
- [ ] çµæœè¡¨ç¤ºæ™‚ã«é©åˆ‡ã«ã‚ºãƒ¼ãƒ ãƒ»ãƒ•ã‚£ãƒƒãƒˆã™ã‚‹
- [ ] ãƒ©ã‚¦ãƒ³ãƒ‰é€²è¡Œã¨é€£å‹•ã—ã¦åœ°å›³ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹

### æ“ä½œæ€§ç¢ºèªé …ç›®
- [ ] ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³æ“ä½œãŒã‚¹ãƒ ãƒ¼ã‚º
- [ ] ã‚³ãƒ³ãƒ‘ã‚¹ã‚¯ãƒªãƒƒã‚¯ã§åŒ—å‘ããƒªã‚»ãƒƒãƒˆã§ãã‚‹
- [ ] è¡›æ˜Ÿãƒ»åœ°å›³è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆãŒã§ãã‚‹
- [ ] ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã‚¿ãƒƒãƒæ“ä½œãŒæ­£å¸¸

## ğŸ“ å®Ÿè£…ãƒ¡ãƒ¢

### é‡è¦ãªè¨­å®šå€¤

#### åœ°å›³åŸºæœ¬è¨­å®š
```typescript
// lib/mapbox/config.ts
export const MAPBOX_CONFIG = {
  style: 'mapbox://styles/mapbox/satellite-v9',
  center: [138.252924, 36.204824] as [number, number], // æ—¥æœ¬ä¸­å¤®
  zoom: 5,
  maxBounds: [
    [129.0, 31.0], // å—è¥¿è§’
    [146.0, 46.0]  // åŒ—æ±è§’
  ] as [[number, number], [number, number]],
  minZoom: 4,
  maxZoom: 18,
} as const;
```

#### ãƒ”ãƒ³è¨­å®š
```typescript
// lib/mapbox/pins.ts
export const PIN_STYLES = {
  guess: {
    color: '#3B82F6', // é’è‰²
    size: 'large',
    draggable: true,
  },
  answer: {
    color: '#EF4444', // èµ¤è‰²
    size: 'large',
    draggable: false,
  },
} as const;
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…ä¾‹

#### åŸºæœ¬åœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
```typescript
// components/map/MapboxMap.tsx
'use client';

import { useEffect, useRef } from 'react';
import mapboxgl from 'mapbox-gl';
import { MAPBOX_CONFIG } from '@/lib/mapbox/config';

interface MapboxMapProps {
  onMapClick?: (coordinates: [number, number]) => void;
  guessPin?: [number, number] | null;
  answerPin?: [number, number] | null;
  showDistanceLine?: boolean;
}

export function MapboxMap({ 
  onMapClick, 
  guessPin, 
  answerPin, 
  showDistanceLine 
}: MapboxMapProps) {
  const mapContainer = useRef<HTMLDivElement>(null);
  const map = useRef<mapboxgl.Map | null>(null);

  useEffect(() => {
    if (!mapContainer.current) return;

    mapboxgl.accessToken = process.env.NEXT_PUBLIC_MAPBOX_ACCESS_TOKEN!;

    map.current = new mapboxgl.Map({
      container: mapContainer.current,
      style: MAPBOX_CONFIG.style,
      center: MAPBOX_CONFIG.center,
      zoom: MAPBOX_CONFIG.zoom,
      maxBounds: MAPBOX_CONFIG.maxBounds,
      minZoom: MAPBOX_CONFIG.minZoom,
      maxZoom: MAPBOX_CONFIG.maxZoom,
    });

    // åœ°å›³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    map.current.on('click', (e) => {
      if (onMapClick) {
        onMapClick([e.lngLat.lng, e.lngLat.lat]);
      }
    });

    return () => {
      map.current?.remove();
    };
  }, [onMapClick]);

  // ãƒ”ãƒ³æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯
  useEffect(() => {
    if (!map.current) return;
    
    // æ¨æ¸¬ãƒ”ãƒ³æ›´æ–°
    if (guessPin) {
      updateGuessPin(map.current, guessPin);
    }
    
    // æ­£è§£ãƒ”ãƒ³æ›´æ–°
    if (answerPin) {
      updateAnswerPin(map.current, answerPin);
    }
    
    // è·é›¢ç·šæ›´æ–°
    if (showDistanceLine && guessPin && answerPin) {
      updateDistanceLine(map.current, guessPin, answerPin);
    }
  }, [guessPin, answerPin, showDistanceLine]);

  return (
    <div 
      ref={mapContainer} 
      className="w-full h-full"
      style={{ minHeight: '400px' }}
    />
  );
}
```

#### ãƒ”ãƒ³ç®¡ç†é–¢æ•°
```typescript
// lib/mapbox/pins.ts
import mapboxgl from 'mapbox-gl';

let guessMarker: mapboxgl.Marker | null = null;
let answerMarker: mapboxgl.Marker | null = null;

export function updateGuessPin(
  map: mapboxgl.Map, 
  coordinates: [number, number]
) {
  // æ—¢å­˜ã®æ¨æ¸¬ãƒ”ãƒ³ã‚’å‰Šé™¤
  if (guessMarker) {
    guessMarker.remove();
  }

  // æ–°ã—ã„æ¨æ¸¬ãƒ”ãƒ³ã‚’ä½œæˆ
  guessMarker = new mapboxgl.Marker({
    color: '#3B82F6',
    draggable: true,
  })
    .setLngLat(coordinates)
    .addTo(map);

  // ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆ
  guessMarker.on('dragend', () => {
    const lngLat = guessMarker!.getLngLat();
    // ãƒ‰ãƒ©ãƒƒã‚°å¾Œã®åº§æ¨™ã‚’ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã«åæ˜ 
    updateGuessCoordinates([lngLat.lng, lngLat.lat]);
  });
}

export function updateAnswerPin(
  map: mapboxgl.Map, 
  coordinates: [number, number]
) {
  // æ—¢å­˜ã®æ­£è§£ãƒ”ãƒ³ã‚’å‰Šé™¤
  if (answerMarker) {
    answerMarker.remove();
  }

  // æ–°ã—ã„æ­£è§£ãƒ”ãƒ³ã‚’ä½œæˆ
  answerMarker = new mapboxgl.Marker({
    color: '#EF4444',
    draggable: false,
  })
    .setLngLat(coordinates)
    .addTo(map);
}
```

#### è·é›¢ç·šæç”»
```typescript
// lib/mapbox/distance-line.ts
import mapboxgl from 'mapbox-gl';

export function updateDistanceLine(
  map: mapboxgl.Map,
  start: [number, number],
  end: [number, number]
) {
  const sourceId = 'distance-line';
  const layerId = 'distance-line-layer';

  // æ—¢å­˜ã®ç·šã‚’å‰Šé™¤
  if (map.getLayer(layerId)) {
    map.removeLayer(layerId);
  }
  if (map.getSource(sourceId)) {
    map.removeSource(sourceId);
  }

  // GeoJSON LineStringä½œæˆ
  const lineGeoJSON = {
    type: 'Feature' as const,
    geometry: {
      type: 'LineString' as const,
      coordinates: [start, end],
    },
    properties: {},
  };

  // ã‚½ãƒ¼ã‚¹ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¿½åŠ 
  map.addSource(sourceId, {
    type: 'geojson',
    data: lineGeoJSON,
  });

  map.addLayer({
    id: layerId,
    type: 'line',
    source: sourceId,
    layout: {
      'line-join': 'round',
      'line-cap': 'round',
    },
    paint: {
      'line-color': '#FF6B6B',
      'line-width': 3,
      'line-opacity': 0.8,
    },
  });

  // ä¸¡ç‚¹ã‚’å«ã‚€ã‚ˆã†ã«åœ°å›³ã‚’ãƒ•ã‚£ãƒƒãƒˆ
  map.fitBounds([start, end], {
    padding: 50,
    maxZoom: 12,
  });
}
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

#### ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
```typescript
// lib/env.ts
export function validateMapboxToken() {
  const token = process.env.NEXT_PUBLIC_MAPBOX_ACCESS_TOKEN;
  
  if (!token) {
    throw new Error('Mapbox access token is required');
  }
  
  if (!token.startsWith('pk.')) {
    throw new Error('Invalid Mapbox access token format');
  }
  
  return token;
}
```

#### ãƒ¡ãƒ¢ãƒªç®¡ç†
```typescript
// hooks/useGameMap.ts
export function useGameMap() {
  const mapRef = useRef<mapboxgl.Map | null>(null);

  // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆæ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  useEffect(() => {
    return () => {
      if (mapRef.current) {
        mapRef.current.remove();
        mapRef.current = null;
      }
    };
  }, []);

  return { mapRef };
}
```

---

**å®Œäº†å¾Œã®æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:** [06_game_logic.md](./06_game_logic.md) ã§ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…é–‹å§‹ 